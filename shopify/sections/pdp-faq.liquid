{% liquid
  assign offer_mode = section.settings.offer_mode
  if offer_mode == 'auto'
    if product.tags contains 'trio'
      assign offer_mode = 'trio'
    else
      assign offer_mode = 'single'
    endif
  endif
  assign display_for = section.settings.display_for
  assign should_render = false
  if display_for == 'all' or display_for == offer_mode
    assign should_render = true
  endif
%}

{% if should_render %}
<section class="pdp-faq" data-offer-mode="{{ offer_mode }}">
  <h2>{{ section.settings.heading }}</h2>
  {% for block in section.blocks %}
    <details {{ block.shopify_attributes }}>
      <summary>{{ block.settings.question }}</summary>
      <p>{{ block.settings.answer }}</p>
    </details>
  {% endfor %}
</section>
{% endif %}

{% schema %}
{
  "name": "PDP FAQ",
  "settings": [
    { "type": "select", "id": "offer_mode", "label": "Offer mode", "default": "auto", "options": [
      { "value": "auto", "label": "Auto" },
      { "value": "single", "label": "Single" },
      { "value": "trio", "label": "Trio" }
    ]},
    { "type": "select", "id": "display_for", "label": "Display for", "default": "all", "options": [
      { "value": "all", "label": "All" },
      { "value": "single", "label": "Single" },
      { "value": "trio", "label": "Trio" }
    ]},
    { "type": "text", "id": "heading", "label": "Heading", "default": "FAQ" }
  ],
  "blocks": [
    {
      "type": "faq_item",
      "name": "FAQ item",
      "settings": [
        { "type": "text", "id": "question", "label": "Question", "default": "{{FAQ_QUESTION}}" },
        { "type": "textarea", "id": "answer", "label": "Answer", "default": "{{FAQ_ANSWER}}" }
      ]
    }
  ],
  "presets": [{ "name": "PDP FAQ" }]
}
{% endschema %}
